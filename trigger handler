// TRIGGER HANDLER - Medi Desk Patient Assistant (Contest-Ready)
response = Map();
// Get visitor information
visitorName = visitor.get("name");
visitorEmail = visitor.get("email");
visitorPhone = visitor.get("phone");
currentPage = visitor.get("page");
// Get current time for personalized greeting
currentHour = now.getHour();
currentDay = now.getDay();
// Determine time-based greeting
greeting = "";
timeEmoji = "";
if(currentHour >= 5 && currentHour < 12)
{
	greeting = "Good Morning";
	timeEmoji = "â˜€ï¸";
}
else if(currentHour >= 12 && currentHour < 17)
{
	greeting = "Good Afternoon";
	timeEmoji = "ðŸŒ¤ï¸";
}
else if(currentHour >= 17 && currentHour < 21)
{
	greeting = "Good Evening";
	timeEmoji = "ðŸŒ†";
}
else
{
	greeting = "Hello";
	timeEmoji = "ðŸŒ™";
}
// Check if it's weekend
isWeekend = false;
if(currentDay == 1 || currentDay == 7)
{
	isWeekend = true;
}
// ========== EMERGENCY PAGE SPECIFIC TRIGGER ==========
if(currentPage != null && (currentPage.contains("/emergency") || currentPage.contains("/urgent")))
{
	response.put("action","reply");
	response.put("replies",{"ðŸš¨ EMERGENCY MEDICAL ASSISTANCE ðŸš¨\n\nAre you facing a medical emergency?\n\nâš ï¸ FOR IMMEDIATE HELP:\nðŸ“ž National Emergency: 112\nðŸ¥ Hospital Emergency: +91-98765-43210\nðŸš‘ Ambulance: +91-98765-43211\n\nðŸ“ Emergency Department:\nMedi Desk Hospital, 2nd Floor\nCity Center, Your City - 400001\n\nâ° 24/7 Emergency Services Available\n\nâš¡ LIFE-THREATENING CONDITIONS:\nâ€¢ Severe chest pain / Heart attack\nâ€¢ Difficulty breathing\nâ€¢ Heavy bleeding\nâ€¢ Loss of consciousness\nâ€¢ Stroke symptoms\nâ€¢ Severe injury\n\nðŸ‘‰ If critical, CALL 112 NOW!\n\nFor non-critical urgent care, I can help you:"});
	inputMap = Map();
	inputMap.put("type","select");
	inputMap.put("options",{"ðŸš‘ Call Emergency Now","ðŸ“ Get Directions to Hospital","âš¡ Book Urgent Appointment","ðŸ‘¨â€âš•ï¸ Talk to Emergency Doctor","ðŸ’Š Find Nearest Pharmacy"});
	response.put("input",inputMap);
}
// ========== HEALTH PACKAGES PAGE SPECIFIC TRIGGER ==========
else if(currentPage != null && (currentPage.contains("/packages") || currentPage.contains("/checkup") || currentPage.contains("/health")))
{
	response.put("action","reply");
	response.put("replies",{greeting + "! " + timeEmoji + " Welcome to Medi Desk Health Packages!\n\nðŸŽŠ LIMITED TIME OFFER - Save up to 40%!\n\nðŸ’š Basic Checkup - â‚¹999 (was â‚¹1,299)\nðŸ’™ Complete Checkup - â‚¹2,499 (was â‚¹2,999)\nðŸ’œ Executive Checkup - â‚¹4,999 (was â‚¹5,999)\n\nâœ¨ SPECIAL BENEFITS:\nâœ“ FREE home sample collection\nâœ“ Reports in 24-48 hours\nâœ“ NABL certified lab\nâœ“ Expert doctor consultation\nâœ“ No hidden charges\n\nðŸŽ Book today and get a FREE diabetes screening!\n\nâ° Offer valid till Dec 31, 2025\n\nReady to invest in your health?"});
	inputMap = Map();
	inputMap.put("type","select");
	inputMap.put("options",{"ðŸ’š Book Basic Package (â‚¹999)","ðŸ’™ Book Complete Package (â‚¹2,499)","ðŸ’œ Book Executive Package (â‚¹4,999)","ðŸ“Š Compare All Packages","â“ Talk to Health Advisor"});
	response.put("input",inputMap);
}
// ========== LAB TESTS PAGE SPECIFIC TRIGGER ==========
else if(currentPage != null && (currentPage.contains("/lab") || currentPage.contains("/test") || currentPage.contains("/diagnostic")))
{
	response.put("action","reply");
	response.put("replies",{greeting + "! " + timeEmoji + " Welcome to Medi Desk Lab Services!\n\nðŸ§ª ACCREDITED DIAGNOSTIC CENTER\n\nâœ… What We Offer:\nâ€¢ Complete Blood Count (CBC)\nâ€¢ Thyroid Profile (T3, T4, TSH)\nâ€¢ Lipid Profile (Cholesterol)\nâ€¢ Diabetes Tests (HbA1c, Fasting)\nâ€¢ COVID-19 RT-PCR\nâ€¢ X-Ray & Ultrasound\nâ€¢ ECG & ECHO\nâ€¢ 500+ other tests\n\nðŸ† Why Choose Us?\nâœ“ NABL certified lab\nâœ“ Home sample collection\nâœ“ Reports in 24-48 hours\nâœ“ Online report access\nâœ“ Competitive pricing\n\nðŸ“± Digital reports via email & SMS\n\nWhat would you like to do?"});
	inputMap = Map();
	inputMap.put("type","select");
	inputMap.put("options",{"ðŸ§ª Book Lab Test","ðŸ  Home Sample Collection","ðŸ“„ View My Reports","ðŸ’° Check Test Prices","ðŸ“ž Talk to Lab Technician"});
	response.put("input",inputMap);
}
// ========== DOCTORS/SPECIALISTS PAGE TRIGGER ==========
else if(currentPage != null && (currentPage.contains("/doctor") || currentPage.contains("/specialist") || currentPage.contains("/appointment")))
{
	response.put("action","reply");
	response.put("replies",{greeting + "! " + timeEmoji + " Welcome to Medi Desk!\n\nðŸ‘¨â€âš•ï¸ EXPERT MEDICAL TEAM\n\n50+ Specialist Doctors | 10+ Specialties\n\nðŸ«€ Cardiology - Heart Specialists\nðŸ¦´ Orthopedics - Bone & Joint Experts\nðŸ‘¶ Pediatrics - Child Care Specialists\nðŸ§´ Dermatology - Skin & Hair Doctors\nðŸ’Š General Medicine - Family Physicians\nðŸ§  Neurology - Brain & Nerve Experts\nðŸ‘ï¸ Ophthalmology - Eye Specialists\nðŸ¦· Dentistry - Dental Surgeons\n\nâœ¨ All doctors:\nâœ“ Board certified\nâœ“ 10+ years experience\nâœ“ Patient-first approach\n\nðŸ“… Same-day appointments available!\n\nHow can I help you?"});
	inputMap = Map();
	inputMap.put("type","select");
	inputMap.put("options",{"ðŸ“… Book Appointment Now","ðŸ‘¨â€âš•ï¸ View All Doctors","ðŸ¥ Browse Specialties","â° Check Availability","ðŸ’¬ Talk to Receptionist"});
	response.put("input",inputMap);
}
// ========== RETURNING VISITOR (Has name and email) ==========
else if(visitorName != null && visitorName != "" && visitorEmail != null && visitorEmail != "")
{
	response.put("action","reply");
	response.put("replies",{greeting + ", " + visitorName + "! " + timeEmoji + "\n\nWelcome back to Medi Desk! ðŸ‘‹\n\nGreat to see you again. I hope you're doing well!\n\nðŸ“‹ YOUR QUICK ACCESS:\nâœ“ View your appointments\nâœ“ Check lab reports\nâœ“ Download prescriptions\nâœ“ Book follow-up\n\nðŸ’™ We're here to take care of your health needs.\n\nWhat brings you here today?"});
	inputMap = Map();
	inputMap.put("type","select");
	inputMap.put("options",{"ðŸ“… Book New Appointment","ðŸ“„ View My Reports","ðŸ’Š My Prescriptions","ðŸ§ª Book Lab Test","ðŸ¥ My Medical History","ðŸ’¬ Talk to Support"});
	response.put("input",inputMap);
}
// ========== NEW VISITOR - WEEKEND GREETING ==========
else if(isWeekend)
{
	response.put("action","reply");
	response.put("replies",{greeting + "! " + timeEmoji + " Welcome to Medi Desk!\n\nðŸ¥ Your 24/7 Healthcare Partner\n\nðŸ“¢ Weekend Special:\nOur OPD is open on Sundays too!\nTimings: 10:00 AM - 6:00 PM\n\nâœ¨ I'm your AI Health Assistant, here to help you with:\n\nðŸ“… Book doctor appointments instantly\nðŸ§ª Schedule lab tests at home\nðŸ’š Explore health checkup packages\nðŸ“„ Access medical reports\nðŸš¨ Get emergency assistance (24/7)\nðŸ’³ Bill payments & insurance queries\n\nðŸ”’ Your data is 100% secure & confidential\nðŸŒŸ Trusted by 1 lakh+ patients\n\nðŸ’™ How can I assist you today?"});
	inputMap = Map();
	inputMap.put("type","select");
	inputMap.put("options",{"ðŸ“… Book Appointment","ðŸ§ª Lab Test Booking","ðŸ’š Health Packages","ðŸš¨ Emergency Help","ðŸ’¬ Chat with Doctor","â„¹ï¸ Learn More"});
	response.put("input",inputMap);
}
// ========== NEW VISITOR - LATE NIGHT GREETING ==========
else if(currentHour >= 21 || currentHour < 5)
{
	response.put("action","reply");
	response.put("replies",{greeting + "! " + timeEmoji + " Welcome to Medi Desk!\n\nðŸŒ™ 24/7 Healthcare Support Available\n\nEven though it's late, I'm here to help!\n\nðŸ¥ What I can do for you right now:\n\nðŸ“… Book appointments for tomorrow\nðŸ§ª Schedule lab tests\nðŸ“„ Access your medical reports\nðŸš¨ Get emergency contact info\nðŸ’¬ Leave a message for our team\n\nâš¡ For medical emergencies:\nCall 112 or our emergency line:\n+91-98765-43210\n\nðŸ’™ How can I assist you tonight?"});
	inputMap = Map();
	inputMap.put("type","select");
	inputMap.put("options",{"ðŸ“… Book Appointment","ðŸš¨ Emergency Contact","ðŸ§ª Schedule Lab Test","ðŸ“„ View Reports","ðŸ’¬ Leave Message","â„¹ï¸ Hospital Info"});
	response.put("input",inputMap);
}
// ========== NEW VISITOR - GENERAL WELCOME (DEFAULT) ==========
else
{
	response.put("action","reply");
	response.put("replies",{greeting + "! " + timeEmoji + " Welcome to Medi Desk!\n\nðŸ¥ Your Trusted Healthcare Partner Since 2010\n\nâœ¨ I'm your AI Health Assistant, here to make healthcare simple and accessible!\n\nðŸ’™ What I Can Help You With:\n\nðŸ“… Book Doctor Appointments\n   â€¢ 50+ specialist doctors\n   â€¢ Same-day slots available\n   â€¢ Video consultations too!\n\nðŸ§ª Lab Test Bookings\n   â€¢ 500+ tests available\n   â€¢ FREE home sample collection\n   â€¢ Reports in 24-48 hours\n\nðŸ’š Health Checkup Packages\n   â€¢ Starting from just â‚¹999\n   â€¢ Comprehensive screening\n   â€¢ Expert consultation included\n\nðŸ“„ View Medical Reports\n   â€¢ Secure online access\n   â€¢ Download anytime\n\nðŸš¨ 24/7 Emergency Support\n   â€¢ Immediate assistance\n   â€¢ Ambulance service\n\nðŸ’³ Billing & Insurance\n   â€¢ Multiple payment options\n   â€¢ 50+ insurance providers\n\nðŸ”’ Your Privacy Matters:\nAll your health data is encrypted and confidential.\n\nðŸŒŸ Trusted by 1,00,000+ patients\nâ­ 4.8/5 patient satisfaction rating\n\nðŸ’™ How can I help you today?"});
	inputMap = Map();
	inputMap.put("type","select");
	inputMap.put("options",{"ðŸ“… Book Appointment","ðŸ§ª Lab Test Booking","ðŸ’š Health Packages","ðŸš¨ Emergency","ðŸ‘¨â€âš•ï¸ Our Doctors","â„¹ï¸ About Us"});
	response.put("input",inputMap);
}
return response;
